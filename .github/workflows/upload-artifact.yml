name: Upload Artifact

on:
  workflow_call:
    inputs:
      artifact-name:
        description: 'Name of the artifact'
        required: false
        type: string
        default: 'build-artifact'
      artifact-path:
        description: 'Path to files/directories to upload'
        required: true
        type: string
      retention-days:
        description: 'Number of days to retain the artifact'
        required: false
        type: number
        default: 90
      upload-to-release:
        description: 'Upload to GitHub Release (requires tag/release)'
        required: false
        type: boolean
        default: false
      if-no-files-found:
        description: 'What to do if no files found (warn, error, ignore)'
        required: false
        type: string
        default: 'warn'
      dry-run:
        description: 'Dry-run mode - skip actual upload (for testing)'
        required: false
        type: boolean
        default: false

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code (if needed for release)
        if: inputs.upload-to-release
        uses: actions/checkout@v4
      
      - name: Display artifact info
        run: |
          echo "Artifact name: ${{ inputs.artifact-name }}"
          echo "Artifact path: ${{ inputs.artifact-path }}"
          echo "Retention days: ${{ inputs.retention-days }}"
          echo "Upload to release: ${{ inputs.upload-to-release }}"
          echo ""
          echo "Files to upload:"
          ls -lah ${{ inputs.artifact-path }} 2>/dev/null || echo "Path not found or empty"
      
      - name: Upload to GitHub Artifacts
        if: ${{ !inputs.dry-run }}
        uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.artifact-name }}
          path: ${{ inputs.artifact-path }}
          retention-days: ${{ inputs.retention-days }}
          if-no-files-found: ${{ inputs.if-no-files-found }}
      
      - name: Dry-run mode - Skip upload
        if: ${{ inputs.dry-run }}
        run: |
          echo "üîç DRY-RUN MODE: Skipping artifact upload"
          echo "Would upload:"
          echo "  Name: ${{ inputs.artifact-name }}"
          echo "  Path: ${{ inputs.artifact-path }}"
          echo "  Retention: ${{ inputs.retention-days }} days"
      
      - name: Upload to GitHub Release
        if: ${{ !inputs.dry-run && inputs.upload-to-release && (github.event_name == 'release' || startsWith(github.ref, 'refs/tags/')) }}
        uses: softprops/action-gh-release@v1
        with:
          files: ${{ inputs.artifact-path }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Summary
        run: |
          echo "‚úÖ Artifact uploaded successfully!"
          echo "Artifact name: ${{ inputs.artifact-name }}"
          echo "Retention: ${{ inputs.retention-days }} days"
